###############################################################################
#
# IAR ANSI C/C++ Compiler V7.30.4.8167/W32 for ARM        02/Jul/2015  09:27:33
# Copyright 1999-2014 IAR Systems AB.
#
#    Cpu mode     =  arm
#    Endian       =  little
#    Source file  =  
#        F:\Dropbox\회사\JDS_PRO\국내 프로젝트\대구
#        모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED(FDI)\at91sam7se-ek\basic-usart-hw-handshaking-project\printf_usart.c
#    Command line =  
#        "F:\Dropbox\회사\JDS_PRO\국내 프로젝트\대구
#        모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED(FDI)\at91sam7se-ek\basic-usart-hw-handshaking-project\printf_usart.c"
#        -D at91sam7se512 -D flash -D TRACE_LEVEL=4 -lC
#        "F:\Dropbox\회사\JDS_PRO\국내 프로젝트\대구
#        모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED(FDI)\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\at91sam7se512_flash\List\"
#        --remarks --diag_suppress Pe826,Pe1375 -o
#        "F:\Dropbox\회사\JDS_PRO\국내 프로젝트\대구
#        모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED(FDI)\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\at91sam7se512_flash\Obj\"
#        --no_cse --no_unroll --no_inline --no_code_motion --no_tbaa
#        --no_clustering --no_scheduling --debug --endian=little --cpu=ARM7TDMI
#        -e --fpu=None --dlib_config "C:\Program Files\IAR Systems\Embedded
#        Workbench 7.0\arm\INC\c\DLib_Config_Full.h" -I
#        "F:\Dropbox\회사\JDS_PRO\국내 프로젝트\대구
#        모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED(FDI)\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\..\..\..\at91lib/peripherals\"
#        -I "F:\Dropbox\회사\JDS_PRO\국내 프로젝트\대구
#        모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED(FDI)\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\..\..\..\at91lib/memories\"
#        -I "F:\Dropbox\회사\JDS_PRO\국내 프로젝트\대구
#        모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED(FDI)\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\..\..\..\at91lib\"
#        -I "F:\Dropbox\회사\JDS_PRO\국내 프로젝트\대구
#        모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED(FDI)\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\..\..\..\at91lib/components\"
#        -I "F:\Dropbox\회사\JDS_PRO\국내 프로젝트\대구
#        모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED(FDI)\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\..\..\..\at91lib/boards/at91sam7se-ek\"
#        --interwork --cpu_mode arm -On --use_c++_inline
#    List file    =  
#        F:\Dropbox\회사\JDS_PRO\국내 프로젝트\대구
#        모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED(FDI)\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\at91sam7se512_flash\List\printf_usart.lst
#    Object file  =  
#        F:\Dropbox\회사\JDS_PRO\국내 프로젝트\대구
#        모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED(FDI)\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\at91sam7se512_flash\Obj\printf_usart.o
#
###############################################################################

F:\Dropbox\회사\JDS_PRO\국내 프로젝트\대구 모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED(FDI)\at91sam7se-ek\basic-usart-hw-handshaking-project\printf_usart.c
      1          /* ----------------------------------------------------------------------------
      2           *         ATMEL Microcontroller Software Support 
      3           * ----------------------------------------------------------------------------
      4           * Copyright (c) 2008, Atmel Corporation
      5           *
      6           * All rights reserved.
      7           *
      8           * Redistribution and use in source and binary forms, with or without
      9           * modification, are permitted provided that the following conditions are met:
     10           *
     11           * - Redistributions of source code must retain the above copyright notice,
     12           * this list of conditions and the disclaimer below.
     13           *
     14           * Atmel's name may not be used to endorse or promote products derived from
     15           * this software without specific prior written permission.
     16           *
     17           * DISCLAIMER: THIS SOFTWARE IS PROVIDED BY ATMEL "AS IS" AND ANY EXPRESS OR
     18           * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
     19           * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT ARE
     20           * DISCLAIMED. IN NO EVENT SHALL ATMEL BE LIABLE FOR ANY DIRECT, INDIRECT,
     21           * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
     22           * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
     23           * OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
     24           * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
     25           * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
     26           * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
     27           * ----------------------------------------------------------------------------
     28           */
     29          
     30          //------------------------------------------------------------------------------
     31          /// \unit
     32          /// This file contains several function re-implementations to make the standard
     33          /// printf() method output on USART0.
     34          ///
     35          /// The re-implemented functions are fputc(), fputs() and putchar().
     36          //------------------------------------------------------------------------------
     37          
     38          //------------------------------------------------------------------------------
     39          //         Headers
     40          //------------------------------------------------------------------------------
     41          
     42          #include <board.h>
     43          #include <usart/usart.h>
     44          
     45          #include <stdio.h>
     46          #ifndef NOFPUT
     47          //------------------------------------------------------------------------------
     48          //         Global functions
     49          //------------------------------------------------------------------------------
     50          
     51          //------------------------------------------------------------------------------
     52          /// Implementation of fputc using USART0 as the standard output. Required
     53          /// for printf().
     54          /// Returns the character written if successful, or -1 if the output stream is
     55          /// not stdout or stderr.
     56          /// \param c  Character to write.
     57          /// \param pStream  Output stream.
     58          //------------------------------------------------------------------------------

   \                                 In section .text, align 4, keep-with-next
     59          signed int fputc(signed int c, FILE *pStream)
     60          {
   \                     fputc:
   \   00000000   0xE92D4038         PUSH     {R3-R5,LR}
   \   00000004   0xE1B04000         MOVS     R4,R0
   \   00000008   0xE1B05001         MOVS     R5,R1
     61              if ((pStream == stdout) || (pStream == stderr)) {
   \   0000000C   0x........         LDR      R0,??DataTable1
   \   00000010   0xE1550000         CMP      R5,R0
   \   00000014   0x0A000002         BEQ      ??fputc_0
   \   00000018   0x........         LDR      R0,??DataTable1_1
   \   0000001C   0xE1550000         CMP      R5,R0
   \   00000020   0x1A000008         BNE      ??fputc_1
     62              
     63                  USART_Write(AT91C_BASE_US0, c, 0);
   \                     ??fputc_0:
   \   00000024   0xE3A02000         MOV      R2,#+0
   \   00000028   0xE1B01004         MOVS     R1,R4
   \   0000002C   0xE1A01801         LSL      R1,R1,#+16
   \   00000030   0xE1B01821         LSRS     R1,R1,#+16
   \   00000034   0xE3A004FC         MOV      R0,#-67108864
   \   00000038   0xE38007FF         ORR      R0,R0,#0x3FC0000
   \   0000003C   0x........         BL       USART_Write
     64                  return c;
   \   00000040   0xE1B00004         MOVS     R0,R4
   \   00000044   0xEA000000         B        ??fputc_2
     65              }
     66              else {
     67          
     68                  return EOF;
   \                     ??fputc_1:
   \   00000048   0xE3E00000         MVN      R0,#+0
   \                     ??fputc_2:
   \   0000004C   0xE8BD4032         POP      {R1,R4,R5,LR}
   \   00000050   0xE12FFF1E         BX       LR               ;; return
     69              }
     70          }
     71          
     72          //------------------------------------------------------------------------------
     73          /// Implementation of fputs using USART0 as the standard output. Required
     74          /// for printf().
     75          /// Returns the number of characters written if successful, or -1 if the output
     76          /// stream is not stdout or stderr.
     77          /// \param pStr  String to write.
     78          /// \param pStream  Output stream.
     79          //------------------------------------------------------------------------------

   \                                 In section .text, align 4, keep-with-next
     80          signed int fputs(const char *pStr, FILE *pStream)
     81          {
   \                     fputs:
   \   00000000   0xE92D4070         PUSH     {R4-R6,LR}
   \   00000004   0xE1B04000         MOVS     R4,R0
   \   00000008   0xE1B05001         MOVS     R5,R1
     82              signed int num = 0;
   \   0000000C   0xE3A06000         MOV      R6,#+0
     83          
     84              while (*pStr != 0) {
   \                     ??fputs_0:
   \   00000010   0xE5D40000         LDRB     R0,[R4, #+0]
   \   00000014   0xE3500000         CMP      R0,#+0
   \   00000018   0x0A000009         BEQ      ??fputs_1
     85          
     86                  if (fputc(*pStr, pStream) == -1) {
   \   0000001C   0xE1B01005         MOVS     R1,R5
   \   00000020   0xE5D40000         LDRB     R0,[R4, #+0]
   \   00000024   0x........         BL       fputc
   \   00000028   0xE3700001         CMN      R0,#+1
   \   0000002C   0x1A000001         BNE      ??fputs_2
     87          
     88                      return -1;
   \   00000030   0xE3E00000         MVN      R0,#+0
   \   00000034   0xEA000003         B        ??fputs_3
     89                  }
     90                  num++;
   \                     ??fputs_2:
   \   00000038   0xE2966001         ADDS     R6,R6,#+1
     91                  pStr++;
   \   0000003C   0xE2944001         ADDS     R4,R4,#+1
   \   00000040   0xEAFFFFF2         B        ??fputs_0
     92              }
     93          
     94              return num;
   \                     ??fputs_1:
   \   00000044   0xE1B00006         MOVS     R0,R6
   \                     ??fputs_3:
   \   00000048   0xE8BD4070         POP      {R4-R6,LR}
   \   0000004C   0xE12FFF1E         BX       LR               ;; return
     95          }
     96          
     97          #undef putchar
     98          
     99          //------------------------------------------------------------------------------
    100          /// Outputs a character on USART0. Returns the character itself.
    101          /// \param c  Character to output.
    102          //------------------------------------------------------------------------------

   \                                 In section .text, align 4, keep-with-next
    103          signed int putchar(signed int c)
    104          {
   \                     putchar:
   \   00000000   0xE92D4010         PUSH     {R4,LR}
   \   00000004   0xE1B04000         MOVS     R4,R0
    105              return fputc(c, stdout);
   \   00000008   0x........         LDR      R1,??DataTable1
   \   0000000C   0xE1B00004         MOVS     R0,R4
   \   00000010   0x........         BL       fputc
   \   00000014   0xE8BD4010         POP      {R4,LR}
   \   00000018   0xE12FFF1E         BX       LR               ;; return
    106          }

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable1:
   \   00000000   0x........         DC32     __iar_Stdout

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable1_1:
   \   00000000   0x........         DC32     __iar_Stderr
    107          
    108          #else
    109          
    110          //------------------------------------------------------------------------------
    111          /// Re-implement DBGU_PutChar function to outputs a character through the 
    112          /// USART0 peripheral
    113          /// \param c  Character to send.
    114          //------------------------------------------------------------------------------
    115          
    116          void DBGU_PutChar(unsigned char ch)
    117          { 
    118              USART_Write(AT91C_BASE_US0, ch, 0);
    119          }
    120          
    121          #endif

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
      16   fputc
        16   -> USART_Write
      16   fputs
        16   -> fputc
       8   putchar
         8   -> fputc


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable1
       4  ??DataTable1_1
      84  fputc
      80  fputs
      28  putchar

 
 200 bytes in section .text
 
 200 bytes of CODE memory

Errors: none
Warnings: none
