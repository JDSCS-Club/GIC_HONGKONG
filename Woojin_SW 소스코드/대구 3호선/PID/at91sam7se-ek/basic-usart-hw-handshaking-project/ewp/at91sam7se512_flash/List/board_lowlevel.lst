###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.30.6.53336/W32 for ARM     06/Apr/2015  18:37:31 #
# Copyright 1999-2012 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  arm                                                      #
#    Endian       =  little                                                   #
#    Source file  =  C:\Users\jang duksu\Dropbox\회사\JDS_PRO\국내            #
#                    프로젝트\대구 모노레일\프로그램\ARM_AT91sam7se512_Dagu_L #
#                    ED\at91lib\boards\at91sam7se-ek\board_lowlevel.c         #
#    Command line =  "C:\Users\jang duksu\Dropbox\회사\JDS_PRO\국내           #
#                    프로젝트\대구 모노레일\프로그램\ARM_AT91sam7se512_Dagu_L #
#                    ED\at91lib\boards\at91sam7se-ek\board_lowlevel.c" -D     #
#                    at91sam7se512 -D flash -D TRACE_LEVEL=4 -lC              #
#                    "C:\Users\jang duksu\Dropbox\회사\JDS_PRO\국내           #
#                    프로젝트\대구 모노레일\프로그램\ARM_AT91sam7se512_Dagu_L #
#                    ED\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\ #
#                    at91sam7se512_flash\List\" --remarks --diag_suppress     #
#                    Pe826,Pe1375 -o "C:\Users\jang                           #
#                    duksu\Dropbox\회사\JDS_PRO\국내 프로젝트\대구            #
#                    모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED\at91sam7se- #
#                    ek\basic-usart-hw-handshaking-project\ewp\at91sam7se512_ #
#                    flash\Obj\" --no_cse --no_unroll --no_inline             #
#                    --no_code_motion --no_tbaa --no_clustering               #
#                    --no_scheduling --debug --endian=little --cpu=ARM7TDMI   #
#                    -e --fpu=None --dlib_config "C:\Program Files\IAR        #
#                    Systems\Embedded Workbench 6.0\arm\INC\c\DLib_Config_Ful #
#                    l.h" -I "C:\Users\jang duksu\Dropbox\회사\JDS_PRO\국내   #
#                    프로젝트\대구 모노레일\프로그램\ARM_AT91sam7se512_Dagu_L #
#                    ED\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\ #
#                    ..\..\..\at91lib/peripherals\" -I "C:\Users\jang         #
#                    duksu\Dropbox\회사\JDS_PRO\국내 프로젝트\대구            #
#                    모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED\at91sam7se- #
#                    ek\basic-usart-hw-handshaking-project\ewp\..\..\..\at91l #
#                    ib/memories\" -I "C:\Users\jang                          #
#                    duksu\Dropbox\회사\JDS_PRO\국내 프로젝트\대구            #
#                    모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED\at91sam7se- #
#                    ek\basic-usart-hw-handshaking-project\ewp\..\..\..\at91l #
#                    ib\" -I "C:\Users\jang duksu\Dropbox\회사\JDS_PRO\국내   #
#                    프로젝트\대구 모노레일\프로그램\ARM_AT91sam7se512_Dagu_L #
#                    ED\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\ #
#                    ..\..\..\at91lib/components\" -I "C:\Users\jang          #
#                    duksu\Dropbox\회사\JDS_PRO\국내 프로젝트\대구            #
#                    모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED\at91sam7se- #
#                    ek\basic-usart-hw-handshaking-project\ewp\..\..\..\at91l #
#                    ib/boards/at91sam7se-ek\" --interwork --cpu_mode arm     #
#                    -On --use_c++_inline                                     #
#    List file    =  C:\Users\jang duksu\Dropbox\회사\JDS_PRO\국내            #
#                    프로젝트\대구 모노레일\프로그램\ARM_AT91sam7se512_Dagu_L #
#                    ED\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\ #
#                    at91sam7se512_flash\List\board_lowlevel.lst              #
#    Object file  =  C:\Users\jang duksu\Dropbox\회사\JDS_PRO\국내            #
#                    프로젝트\대구 모노레일\프로그램\ARM_AT91sam7se512_Dagu_L #
#                    ED\at91sam7se-ek\basic-usart-hw-handshaking-project\ewp\ #
#                    at91sam7se512_flash\Obj\board_lowlevel.o                 #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\jang duksu\Dropbox\회사\JDS_PRO\국내 프로젝트\대구 모노레일\프로그램\ARM_AT91sam7se512_Dagu_LED\at91lib\boards\at91sam7se-ek\board_lowlevel.c
      1          /* ----------------------------------------------------------------------------
      2           *         ATMEL Microcontroller Software Support 
      3           * ----------------------------------------------------------------------------
      4           * Copyright (c) 2008, Atmel Corporation
      5           *
      6           * All rights reserved.
      7           *
      8           * Redistribution and use in source and binary forms, with or without
      9           * modification, are permitted provided that the following conditions are met:
     10           *
     11           * - Redistributions of source code must retain the above copyright notice,
     12           * this list of conditions and the disclaimer below.
     13           *
     14           * Atmel's name may not be used to endorse or promote products derived from
     15           * this software without specific prior written permission.
     16           *
     17           * DISCLAIMER: THIS SOFTWARE IS PROVIDED BY ATMEL "AS IS" AND ANY EXPRESS OR
     18           * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
     19           * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT ARE
     20           * DISCLAIMED. IN NO EVENT SHALL ATMEL BE LIABLE FOR ANY DIRECT, INDIRECT,
     21           * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
     22           * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
     23           * OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
     24           * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
     25           * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
     26           * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
     27           * ----------------------------------------------------------------------------
     28           */
     29          
     30          //------------------------------------------------------------------------------
     31          /// \unit
     32          ///
     33          /// !Purpose
     34          ///
     35          /// Provides the low-level initialization function that gets called on chip
     36          /// startup.
     37          ///
     38          /// !Usage
     39          ///
     40          /// LowLevelInit() is called in #board_cstartup.S#.
     41          //------------------------------------------------------------------------------
     42          
     43          //------------------------------------------------------------------------------
     44          //         Headers
     45          //------------------------------------------------------------------------------
     46          
     47          #include "board.h"
     48          #include "board_memories.h"
     49          #include <pmc/pmc.h>
     50          
     51          //------------------------------------------------------------------------------
     52          //         Internal definitions
     53          //------------------------------------------------------------------------------
     54          // Startup time of main oscillator (in number of slow clock ticks).
     55          #define BOARD_OSCOUNT           (AT91C_CKGR_OSCOUNT & (0x40 << 8))
     56          
     57          // USB PLL divisor value to obtain a 48MHz clock.
     58          #define BOARD_USBDIV            AT91C_CKGR_USBDIV_1
     59          
     60          // PLL frequency range.
     61          #define BOARD_CKGR_PLL          AT91C_CKGR_OUT_0
     62          
     63          // PLL startup time (in number of slow clock ticks).
     64          #define BOARD_PLLCOUNT          (16 << 8)
     65          
     66          // PLL MUL value.
     67          #define BOARD_MUL               (AT91C_CKGR_MUL & (72 << 16))
     68          
     69          // PLL DIV value.
     70          #define BOARD_DIV               (AT91C_CKGR_DIV & 14)
     71          
     72          // Master clock prescaler value.
     73          #define BOARD_PRESCALER         AT91C_PMC_PRES_CLK_2
     74          
     75          //------------------------------------------------------------------------------
     76          //         Internal functions
     77          //------------------------------------------------------------------------------
     78          //------------------------------------------------------------------------------
     79          /// Default spurious interrupt handler. Infinite loop.
     80          //------------------------------------------------------------------------------

   \                                 In section .text, align 4, keep-with-next
     81          void defaultSpuriousHandler( void )
     82          {
     83              while (1);
   \                     defaultSpuriousHandler:
   \                     ??defaultSpuriousHandler_0:
   \   00000000   0xEAFFFFFE         B        ??defaultSpuriousHandler_0
     84          }
     85          
     86          //------------------------------------------------------------------------------
     87          /// Default handler for fast interrupt requests. Infinite loop.
     88          //------------------------------------------------------------------------------

   \                                 In section .text, align 4, keep-with-next
     89          void defaultFiqHandler( void )
     90          {
     91              while (1);
   \                     defaultFiqHandler:
   \                     ??defaultFiqHandler_0:
   \   00000000   0xEAFFFFFE         B        ??defaultFiqHandler_0
     92          }
     93          
     94          //------------------------------------------------------------------------------
     95          /// Default handler for standard interrupt requests. Infinite loop.
     96          //------------------------------------------------------------------------------

   \                                 In section .text, align 4, keep-with-next
     97          void defaultIrqHandler( void )
     98          {
     99              while (1);
   \                     defaultIrqHandler:
   \                     ??defaultIrqHandler_0:
   \   00000000   0xEAFFFFFE         B        ??defaultIrqHandler_0
    100          }
    101          
    102          
    103          //------------------------------------------------------------------------------
    104          //         Exported functions
    105          //------------------------------------------------------------------------------
    106          
    107          //------------------------------------------------------------------------------
    108          /// Performs the low-level initialization of the chip. This includes EFC, master
    109          /// clock, AIC & watchdog configuration, as well as memory remapping.
    110          //------------------------------------------------------------------------------

   \                                 In section .text, align 4, keep-with-next
    111          void LowLevelInit( void )
    112          {
   \                     LowLevelInit:
   \   00000000   0xE92D4010         PUSH     {R4,LR}
    113              unsigned char i;
    114          
    115              BOARD_ConfigureFlash48MHz();
   \   00000004   0x........         BL       BOARD_ConfigureFlash48MHz
    116          
    117          //#if !defined(sdram)
    118              /* Initialize main oscillator
    119               ****************************/
    120              AT91C_BASE_PMC->PMC_MOR = BOARD_OSCOUNT | AT91C_CKGR_MOSCEN;
   \   00000008   0xE3E000DF         MVN      R0,#+223
   \   0000000C   0xE3C00FC0         BIC      R0,R0,#0x300
   \   00000010   0xE3A01001         MOV      R1,#+1
   \   00000014   0xE3811C40         ORR      R1,R1,#0x4000
   \   00000018   0xE5801000         STR      R1,[R0, #+0]
    121              while (!(AT91C_BASE_PMC->PMC_SR & AT91C_PMC_MOSCS));
   \                     ??LowLevelInit_0:
   \   0000001C   0xE3E00097         MVN      R0,#+151
   \   00000020   0xE3C00FC0         BIC      R0,R0,#0x300
   \   00000024   0xE5900000         LDR      R0,[R0, #+0]
   \   00000028   0xE3100001         TST      R0,#0x1
   \   0000002C   0x0AFFFFFA         BEQ      ??LowLevelInit_0
    122          
    123              /* Initialize PLL at 96MHz (96.109) and USB clock to 48MHz */
    124              AT91C_BASE_PMC->PMC_PLLR = BOARD_USBDIV | BOARD_CKGR_PLL | BOARD_PLLCOUNT
    125                                         | BOARD_MUL | BOARD_DIV;
   \   00000030   0xE3E000D3         MVN      R0,#+211
   \   00000034   0xE3C00FC0         BIC      R0,R0,#0x300
   \   00000038   0x........         LDR      R1,??DataTable0  ;; 0x1048100e
   \   0000003C   0xE5801000         STR      R1,[R0, #+0]
    126              while (!(AT91C_BASE_PMC->PMC_SR & AT91C_PMC_LOCK));
   \                     ??LowLevelInit_1:
   \   00000040   0xE3E00097         MVN      R0,#+151
   \   00000044   0xE3C00FC0         BIC      R0,R0,#0x300
   \   00000048   0xE5900000         LDR      R0,[R0, #+0]
   \   0000004C   0xE3100004         TST      R0,#0x4
   \   00000050   0x0AFFFFFA         BEQ      ??LowLevelInit_1
    127          
    128              /* Wait for the master clock if it was already initialized */
    129              while (!(AT91C_BASE_PMC->PMC_SR & AT91C_PMC_MCKRDY));
   \                     ??LowLevelInit_2:
   \   00000054   0xE3E00097         MVN      R0,#+151
   \   00000058   0xE3C00FC0         BIC      R0,R0,#0x300
   \   0000005C   0xE5900000         LDR      R0,[R0, #+0]
   \   00000060   0xE3100008         TST      R0,#0x8
   \   00000064   0x0AFFFFFA         BEQ      ??LowLevelInit_2
    130          
    131              /* Switch to fast clock
    132               **********************/
    133              /* Switch to slow clock + prescaler */
    134              AT91C_BASE_PMC->PMC_MCKR = BOARD_PRESCALER;
   \   00000068   0xE3E000CF         MVN      R0,#+207
   \   0000006C   0xE3C00FC0         BIC      R0,R0,#0x300
   \   00000070   0xE3A01004         MOV      R1,#+4
   \   00000074   0xE5801000         STR      R1,[R0, #+0]
    135              while (!(AT91C_BASE_PMC->PMC_SR & AT91C_PMC_MCKRDY));
   \                     ??LowLevelInit_3:
   \   00000078   0xE3E00097         MVN      R0,#+151
   \   0000007C   0xE3C00FC0         BIC      R0,R0,#0x300
   \   00000080   0xE5900000         LDR      R0,[R0, #+0]
   \   00000084   0xE3100008         TST      R0,#0x8
   \   00000088   0x0AFFFFFA         BEQ      ??LowLevelInit_3
    136          
    137              /* Switch to fast clock + prescaler */
    138              AT91C_BASE_PMC->PMC_MCKR |= AT91C_PMC_CSS_PLL_CLK;
   \   0000008C   0xE3E000CF         MVN      R0,#+207
   \   00000090   0xE3C00FC0         BIC      R0,R0,#0x300
   \   00000094   0xE5900000         LDR      R0,[R0, #+0]
   \   00000098   0xE3900003         ORRS     R0,R0,#0x3
   \   0000009C   0xE3E010CF         MVN      R1,#+207
   \   000000A0   0xE3C11FC0         BIC      R1,R1,#0x300
   \   000000A4   0xE5810000         STR      R0,[R1, #+0]
    139              while (!(AT91C_BASE_PMC->PMC_SR & AT91C_PMC_MCKRDY));
   \                     ??LowLevelInit_4:
   \   000000A8   0xE3E00097         MVN      R0,#+151
   \   000000AC   0xE3C00FC0         BIC      R0,R0,#0x300
   \   000000B0   0xE5900000         LDR      R0,[R0, #+0]
   \   000000B4   0xE3100008         TST      R0,#0x8
   \   000000B8   0x0AFFFFFA         BEQ      ??LowLevelInit_4
    140          //#endif //#if !defined(sdram)
    141              
    142              /* Initialize AIC
    143               ****************/
    144              AT91C_BASE_AIC->AIC_IDCR = 0xFFFFFFFF;
   \   000000BC   0xE3E000DB         MVN      R0,#+219
   \   000000C0   0xE3C00EE0         BIC      R0,R0,#0xE00
   \   000000C4   0xE3E01000         MVN      R1,#+0
   \   000000C8   0xE5801000         STR      R1,[R0, #+0]
    145              AT91C_BASE_AIC->AIC_SVR[0] = (unsigned int) defaultFiqHandler;
   \   000000CC   0xE3E0007F         MVN      R0,#+127
   \   000000D0   0xE3C00EF0         BIC      R0,R0,#0xF00
   \   000000D4   0x........         ADR      R1,defaultFiqHandler
   \   000000D8   0xE5801000         STR      R1,[R0, #+0]
    146              for (i = 1; i < 31; i++) {
   \   000000DC   0xE3A00001         MOV      R0,#+1
   \   000000E0   0xE1B04000         MOVS     R4,R0
   \                     ??LowLevelInit_5:
   \   000000E4   0xE21440FF         ANDS     R4,R4,#0xFF      ;; Zero extend
   \   000000E8   0xE354001F         CMP      R4,#+31
   \   000000EC   0x2A000006         BCS      ??LowLevelInit_6
    147          
    148                  AT91C_BASE_AIC->AIC_SVR[i] = (unsigned int) defaultIrqHandler;
   \   000000F0   0xE1B00004         MOVS     R0,R4
   \   000000F4   0xE21000FF         ANDS     R0,R0,#0xFF      ;; Zero extend
   \   000000F8   0xE1B00100         LSLS     R0,R0,#+2
   \   000000FC   0x........         ADR      R1,defaultIrqHandler
   \   00000100   0xE5001F80         STR      R1,[R0, #-3968]
    149              }
   \   00000104   0xE2944001         ADDS     R4,R4,#+1
   \   00000108   0xEAFFFFF5         B        ??LowLevelInit_5
    150              AT91C_BASE_AIC->AIC_SPU = (unsigned int) defaultSpuriousHandler;
   \                     ??LowLevelInit_6:
   \   0000010C   0xE3E000CB         MVN      R0,#+203
   \   00000110   0xE3C00EE0         BIC      R0,R0,#0xE00
   \   00000114   0x........         ADR      R1,defaultSpuriousHandler
   \   00000118   0xE5801000         STR      R1,[R0, #+0]
    151          
    152              // Unstack nested interrupts
    153              for (i = 0; i < 8 ; i++) {
   \   0000011C   0xE3A00000         MOV      R0,#+0
   \   00000120   0xE1B04000         MOVS     R4,R0
   \                     ??LowLevelInit_7:
   \   00000124   0xE21440FF         ANDS     R4,R4,#0xFF      ;; Zero extend
   \   00000128   0xE3540008         CMP      R4,#+8
   \   0000012C   0x2A000005         BCS      ??LowLevelInit_8
    154          
    155                  AT91C_BASE_AIC->AIC_EOICR = 0;
   \   00000130   0xE3E000CF         MVN      R0,#+207
   \   00000134   0xE3C00EE0         BIC      R0,R0,#0xE00
   \   00000138   0xE3A01000         MOV      R1,#+0
   \   0000013C   0xE5801000         STR      R1,[R0, #+0]
    156              }
   \   00000140   0xE2944001         ADDS     R4,R4,#+1
   \   00000144   0xEAFFFFF6         B        ??LowLevelInit_7
    157          
    158              // Enable Debug mode
    159              AT91C_BASE_AIC->AIC_DCR = AT91C_AIC_DCR_PROT;
   \                     ??LowLevelInit_8:
   \   00000148   0xE3E000C7         MVN      R0,#+199
   \   0000014C   0xE3C00EE0         BIC      R0,R0,#0xE00
   \   00000150   0xE3A01001         MOV      R1,#+1
   \   00000154   0xE5801000         STR      R1,[R0, #+0]
    160          
    161              /* Watchdog initialization
    162               *************************/
    163              AT91C_BASE_WDTC->WDTC_WDMR = AT91C_WDTC_WDDIS;
   \   00000158   0xE3E000BB         MVN      R0,#+187
   \   0000015C   0xE3C00F80         BIC      R0,R0,#0x200
   \   00000160   0xE3A01C80         MOV      R1,#+32768
   \   00000164   0xE5801000         STR      R1,[R0, #+0]
    164          
    165              /* Remap
    166               *******/
    167              BOARD_RemapRam();
   \   00000168   0x........         BL       BOARD_RemapRam
    168          
    169              // Disable RTT and PIT interrupts (potential problem when program A
    170              // configures RTT, then program B wants to use PIT only, interrupts
    171              // from the RTT will still occur since they both use AT91C_ID_SYS)
    172              AT91C_BASE_RTTC->RTTC_RTMR &= ~(AT91C_RTTC_ALMIEN | AT91C_RTTC_RTTINCIEN);
                                                   ^
Remark[Pe068]: integer conversion resulted in a change of sign
   \   0000016C   0xE3E000DF         MVN      R0,#+223
   \   00000170   0xE3C00F80         BIC      R0,R0,#0x200
   \   00000174   0xE5900000         LDR      R0,[R0, #+0]
   \   00000178   0xE3D00BC0         BICS     R0,R0,#0x30000
   \   0000017C   0xE3E010DF         MVN      R1,#+223
   \   00000180   0xE3C11F80         BIC      R1,R1,#0x200
   \   00000184   0xE5810000         STR      R0,[R1, #+0]
    173              AT91C_BASE_PITC->PITC_PIMR &= ~AT91C_PITC_PITIEN;
                                                   ^
Remark[Pe068]: integer conversion resulted in a change of sign
   \   00000188   0xE3E000CF         MVN      R0,#+207
   \   0000018C   0xE3C00F80         BIC      R0,R0,#0x200
   \   00000190   0xE5900000         LDR      R0,[R0, #+0]
   \   00000194   0xE3D00780         BICS     R0,R0,#0x2000000
   \   00000198   0xE3E010CF         MVN      R1,#+207
   \   0000019C   0xE3C11F80         BIC      R1,R1,#0x200
   \   000001A0   0xE5810000         STR      R0,[R1, #+0]
    174          }
   \   000001A4   0xE8BD4010         POP      {R4,LR}
   \   000001A8   0xE12FFF1E         BX       LR               ;; return

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable0:
   \   00000000   0x1048100E         DC32     0x1048100e
    175          

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
        8  LowLevelInit
             8 -> BOARD_ConfigureFlash48MHz
             8 -> BOARD_RemapRam
        0  defaultFiqHandler
        0  defaultIrqHandler
        0  defaultSpuriousHandler


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable0
     428  LowLevelInit
       4  defaultFiqHandler
       4  defaultIrqHandler
       4  defaultSpuriousHandler

 
 444 bytes in section .text
 
 444 bytes of CODE memory

Errors: none
Warnings: none
